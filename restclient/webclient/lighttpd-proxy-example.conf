server.modules = (
    "mod_access",
    "mod_alias",
    "mod_proxy",
    "mod_rewrite"  # Ensure mod_rewrite is included for URL rewriting
)

server.document-root = "/var/www/html"  # Path to your web files
server.port = 80  # Listen on port 80

# Define the REST service address
$REST_SERVICE = "rest-service:32768"

# Serve your web pages
url.rewrite-once = (
    "^/api/(.*)" => "/api/$1"  # Rewrite API requests
)

# Proxy to REST service
$HTTP["url"] =~ "^/api/" {
    proxy.server = (
        "" => ( $REST_SERVICE )  # Use the defined REST service variable
    )
    proxy.kvserver = (
        "X-Real-IP" => "$REMOTE_ADDR",
        "X-Forwarded-For" => "$HTTP["REMOTE_ADDR"]"
    )
}

# Optional: Custom error handling
server.error-handler-404 = "/404.html"  # Custom 404 error page
server.error-handler-500 = "/50x.html"  # Custom 5xx error pages
